<?php
if (!isset($status))
    $status = 'available';
if (!isset($mode))
    $mode = 'user';
if (!isset($transfers) || !is_array($transfers))
    $transfers = array();
?>
<article class="small-12 columns">
    <table class="guests list" data-status="<?php echo $status ?>" data-mode="<?php echo $mode ?>">
        <thead>
            <tr>
                <th class="from">{tr:from}</th>
                <th class="to">{tr:to}</th>
                <th class="subject">{tr:subject}</th>
                <th class="message">{tr:message}</th>
                <th class="created">{tr:created}</th>
                <th class="expires">{tr:expires}</th>
                <th class="actions">{tr:actions}</th>
            </tr>
        </thead>

        <tbody>

        </tbody>
        <?php foreach ($guests as $guest) { ?>
            <tr class="guest" data-id="<?php echo $guest->id ?>" data-errors="<?php echo count($guest->errors) ? '1' : '' ?>">
                <td data-title="From" class="from">
                    <abbr title="<?php echo Utilities::sanitizeOutput($guest->user_email) ?>">
                        <?php echo Utilities::sanitizeOutput(substr($guest->user_email, 0, strpos($guest->user_email, '@'))) ?>
                    </abbr>
                </td>

                <td data-title="To" class="to">
                    <abbr title="<?php echo Utilities::sanitizeOutput($guest->email) ?>">
                        <?php echo Utilities::sanitizeOutput($guest->name) ?>
                    </abbr>
                    <?php
                    if ($guest->errors)
                        echo '<br /><span class="errors">' . implode(', ', array_map(function($type) {
                                    return Lang::tr('recipient_error_' . $type);
                                }, array_unique(array_map(function($error) {
                                                    return $error->type;
                                                }, $guest->errors)))) . '</span>'
                        ?>
                </td>

                <td data-title="Subject" class="subject">
                    <?php if (strlen($guest->subject) > 15) { ?>
                        <span class="short"><?php echo Template::sanitizeOutput(substr($guest->subject, 0, 15)) ?></span>
                        <span class="clickable expand">[...]</span>
                        <div class="full"><?php echo Template::sanitizeOutput($guest->subject) ?></div>
                    <?php } else echo Template::sanitizeOutput($guest->subject) ?>
                </td>

                <td data-title="Message" class="message">
                    <?php if (strlen($guest->message) > 15) { ?>
                        <span class="short"><?php echo Template::sanitizeOutput(substr($guest->message, 0, 15)) ?></span>
                        <span class="clickable expand">[...]</span>
                        <div class="full"><?php echo Template::sanitizeOutput($guest->message) ?></div>
                    <?php } else echo Template::sanitizeOutput($guest->message) ?>
                </td>

                <td data-title="Created" class="created"><?php echo Utilities::formatDate($guest->created) ?></td>

                <td data-title="Expires" class="expires"><?php echo $guest->hasOption(GuestOptions::DOES_NOT_EXPIRE) ? Lang::tr('never') : Utilities::formatDate($guest->expires) ?></td>

                <td data-title="Actions" class="actions"></td>
            </tr>
        <?php } ?>

        <?php if (!count($guests)) { ?>
            <tr>
                <td colspan="7">{tr:no_guests}</td>
            </tr>
        <?php } ?>
        </tbody>
    </table>
</article>
<script type="text/javascript" src="{path:js/guests_table.js}"></script>

